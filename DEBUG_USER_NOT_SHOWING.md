# ğŸ” ì‚¬ì—…ì í”„ë¡œí•„ ì €ì¥ ì•ˆë˜ëŠ” ë¬¸ì œ ë””ë²„ê¹… ê°€ì´ë“œ

## ğŸ› ë¬¸ì œ ë°œê²¬ ë° ìˆ˜ì •

### **ë°œê²¬ëœ ì›ì¸: ì»¬ëŸ¼ëª… ë¶ˆì¼ì¹˜**

**ë¬¸ì œì˜ ì½”ë“œ** (`auth_service.dart` Line 332):
```dart
if (role == 'business') 'businessStatus': 'pending',  // âŒ camelCase
```

**Supabase í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ**:
```sql
businessstatus TEXT  -- âœ… lowercase
```

**ê²°ê³¼**: Supabaseì— `businessStatus` ì»¬ëŸ¼ì´ ì—†ì–´ì„œ ì—…ë°ì´íŠ¸ê°€ ë¬´ì‹œë˜ê±°ë‚˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.

---

## âœ… ìˆ˜ì • ì™„ë£Œ

### 1. `updateRole` í•¨ìˆ˜ ìˆ˜ì •
```dart
// ìˆ˜ì • ì „
'businessStatus': 'pending'

// ìˆ˜ì • í›„
'businessstatus': 'pending'  // âœ… ì†Œë¬¸ìë¡œ í†µì¼
```

### 2. ë¡œê¹… ê°•í™”
ì´ì œ ë‹¤ìŒ ì •ë³´ë¥¼ ë¡œê·¸ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
ğŸ“ ì‚¬ì—…ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹œë„: ID=bedf63fe-...
   ì—…ë°ì´íŠ¸ ë°ì´í„°: {name: ..., phonenumber: ..., businessname: ..., ...}
âœ… Supabase ì‚¬ì—…ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì„±ê³µ: bedf63fe-...
   ì—…ë°ì´íŠ¸ëœ í–‰ ìˆ˜: 1
   ì—…ë°ì´íŠ¸ëœ ë°ì´í„°: {id: ..., name: ..., role: business, businessstatus: pending, ...}
```

ë˜ëŠ” ë¬¸ì œê°€ ìˆëŠ” ê²½ìš°:
```
âš ï¸  ê²½ê³ : ì—…ë°ì´íŠ¸ëŠ” ì„±ê³µí–ˆìœ¼ë‚˜ ë°˜í™˜ëœ ë°ì´í„° ì—†ìŒ (í•´ë‹¹ IDë¥¼ ì°¾ì§€ ëª»í–ˆì„ ìˆ˜ ìˆìŒ)
```

---

## ğŸ§ª **ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°**

### **Step 1: ì•± ì¬ì‹¤í–‰**
```bash
cd /Users/hurmin-ho/Documents/dev/allsuriapp
flutter run
```

### **Step 2: ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸**
1. í™ˆ í™”ë©´ì—ì„œ "ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì‹œì‘í•˜ê¸°" ë²„íŠ¼ í´ë¦­
2. ë¡œê·¸ì¸ ì™„ë£Œ í›„ ì‚¬ì—…ì í”„ë¡œí•„ í™”ë©´ ì§„ì…

### **Step 3: ì‚¬ì—…ì í”„ë¡œí•„ ì…ë ¥**
í•„ìˆ˜ í•­ëª©:
- âœ… ì´ë¦„
- âœ… ì „í™”ë²ˆí˜¸
- âœ… ì‚¬ì—…ìëª…

### **Step 4: ë¡œê·¸ í™•ì¸**
"ë“±ë¡" ë²„íŠ¼ í´ë¦­ í›„ **ì½˜ì†” ë¡œê·¸**ì—ì„œ ë‹¤ìŒ í™•ì¸:

```
âœ… Supabase ì—­í•  ì—…ë°ì´íŠ¸ ì„±ê³µ: [UUID], role=business, businessstatus=pending
   ì—…ë°ì´íŠ¸ëœ ë°ì´í„°: {...}

ğŸ“ ì‚¬ì—…ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹œë„: ID=[UUID]
   ì—…ë°ì´íŠ¸ ë°ì´í„°: {name: ..., phonenumber: ..., businessname: ..., ...}
âœ… Supabase ì‚¬ì—…ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì„±ê³µ: [UUID]
   ì—…ë°ì´íŠ¸ëœ í–‰ ìˆ˜: 1  â† ì´ê²Œ 1ì´ì–´ì•¼ í•©ë‹ˆë‹¤!
   ì—…ë°ì´íŠ¸ëœ ë°ì´í„°: {...}
```

### **Step 5: Admin Page í™•ì¸**
1. `https://api.allsuri.app/admin` ì ‘ì†
2. "ì‚¬ìš©ì ê´€ë¦¬" ì„¹ì…˜ í™•ì¸
3. **ë¸Œë¼ìš°ì € ê°•ì œ ìƒˆë¡œê³ ì¹¨**: `Cmd + Shift + R` (Mac) ë˜ëŠ” `Ctrl + Shift + R` (Windows)
4. ë°©ê¸ˆ ë“±ë¡í•œ ì‚¬ì—…ìê°€ ë³´ì´ëŠ”ì§€ í™•ì¸

---

## ğŸ” **ì—¬ì „íˆ ì•ˆë³´ì¸ë‹¤ë©´?**

### **ì²´í¬ë¦¬ìŠ¤íŠ¸**

#### 1. **ë¡œê·¸ì—ì„œ "ì—…ë°ì´íŠ¸ëœ í–‰ ìˆ˜: 0" ì´ ë‚˜ì˜¨ë‹¤ë©´**
â†’ í•´ë‹¹ UUIDê°€ Supabaseì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**í™•ì¸ ë°©ë²•**:
```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰
SELECT * FROM users WHERE id = '[ë¡œê·¸ì— ë‚˜ì˜¨ UUID]';
```

**í•´ê²°ì±…**:
- ì‚¬ìš©ìê°€ ì²˜ìŒ ìƒì„±ë  ë•Œ UUIDê°€ ì˜¬ë°”ë¥´ê²Œ ì‚½ì…ë˜ì—ˆëŠ”ì§€ í™•ì¸
- `auth-kakao-login.ts` Netlify Functionì´ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸

#### 2. **ë¡œê·¸ì— "Supabase ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€" ì´ ë‚˜ì˜¨ë‹¤ë©´**
â†’ Supabase ì„¤ì •ì´ ëˆ„ë½ë˜ì—ˆê±°ë‚˜, UUID í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.

**í™•ì¸ ì‚¬í•­**:
```
âš ï¸  Supabase ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€ (supaReady: false, uuidLike: false)
   í˜„ì¬ ì‚¬ìš©ì ID: kakao:1234567890  â† ì´ê²Œ UUIDê°€ ì•„ë‹˜!
```

**í•´ê²°ì±…**:
- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œ ë°±ì—”ë“œê°€ UUIDë¥¼ ìƒì„±í•˜ê³  ìˆëŠ”ì§€ í™•ì¸
- `SUPABASE_URL` ë° `SUPABASE_ANON_KEY` í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸

#### 3. **ë¡œê·¸ì— ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤ë©´**
```
âŒ Supabase ë™ê¸°í™” ì‹¤íŒ¨(ë¬´ì‹œí•˜ê³  ë¡œì»¬ ë°˜ì˜): [ì—ëŸ¬ ë©”ì‹œì§€]
```

â†’ **ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”!**

---

## ğŸ“Š **Supabaseì—ì„œ ì§ì ‘ í™•ì¸**

### SQL ì¿¼ë¦¬ë¡œ í™•ì¸:
```sql
-- ëª¨ë“  ì‚¬ì—…ì ì‚¬ìš©ì í™•ì¸
SELECT 
  id, 
  name, 
  email, 
  role, 
  businessstatus,
  businessname,
  phonenumber,
  createdat
FROM users
WHERE role = 'business'
ORDER BY createdat DESC
LIMIT 10;
```

### ì˜ˆìƒ ê²°ê³¼:
| id | name | email | role | businessstatus | businessname |
|----|------|-------|------|----------------|--------------|
| bedf63fe-... | í™ê¸¸ë™ | test@kakao.com | business | pending | í™ê¸¸ë™ ì„¤ë¹„ |

---

## ğŸš¨ **ê¸´ê¸‰ ëŒ€ì‘: Supabase RLS ì •ì±… í™•ì¸**

ë§Œì•½ ë°ì´í„°ëŠ” ìˆëŠ”ë° Admin Pageì—ì„œ ì•ˆë³´ì¸ë‹¤ë©´, **RLS(Row Level Security) ì •ì±…** ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í™•ì¸ ë°©ë²•:
```sql
-- RLS ì •ì±… í™•ì¸
SELECT 
  schemaname,
  tablename,
  policyname,
  cmd,
  roles
FROM pg_policies
WHERE tablename = 'users';
```

### í•„ìš”í•œ ì •ì±…:
```sql
-- Service role (Netlify Functions)ì´ ëª¨ë“  ë°ì´í„° ì ‘ê·¼ ê°€ëŠ¥
CREATE POLICY "Service role has full access"
ON users FOR ALL TO service_role
USING (true) WITH CHECK (true);
```

---

## ğŸ“ **ë¡œê·¸ ê³µìœ  ì‹œ í¬í•¨í•´ì•¼ í•  ì •ë³´**

ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ë‹¤ìŒ ë¡œê·¸ë¥¼ ë³µì‚¬í•´ì„œ ê³µìœ í•´ì£¼ì„¸ìš”:

1. **ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì§í›„**:
   ```
   [API][POST] https://api.allsuri.app/api/auth/kakao/login
   [API][POST] 200 OK
   âœ… Supabase ì—­í•  ì—…ë°ì´íŠ¸ ì„±ê³µ: [UUID]
   ```

2. **ì‚¬ì—…ì í”„ë¡œí•„ ë“±ë¡ ì‹œ**:
   ```
   ğŸ“ ì‚¬ì—…ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹œë„: ID=[UUID]
   ì—…ë°ì´íŠ¸ ë°ì´í„°: {...}
   âœ… Supabase ì‚¬ì—…ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì„±ê³µ
   ì—…ë°ì´íŠ¸ëœ í–‰ ìˆ˜: [ìˆ«ì]
   ```

3. **Supabase SQL ê²°ê³¼**:
   ```sql
   SELECT * FROM users WHERE id = '[UUID]';
   ```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-01-09
**ìˆ˜ì •ëœ íŒŒì¼**: `lib/services/auth_service.dart`
**ì£¼ìš” ë³€ê²½**: `businessStatus` â†’ `businessstatus` (ì»¬ëŸ¼ëª… í†µì¼)

