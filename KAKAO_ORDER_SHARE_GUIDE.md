# 카카오톡 오더 공유 기능 가이드

## 📋 개요

사업자가 새로운 오더를 생성하고 "오더로 올리기"를 선택하면, 카카오톡 단체방에 오더 정보를 공유할 수 있는 기능입니다.

## 🎯 기능 흐름

### 1. 오더 생성 프로세스
```
사업자 → 공사 만들기 → 정보 입력 (제목, 지역, 사진 등) 
→ 공사 등록 → 오더로 올리기 선택 
→ 카카오톡 공유 다이얼로그 표시 
→ 공유하기 클릭 → 카카오톡 앱 열림 → 단체방 선택 → 전송
```

### 2. 공유 다이얼로그
오더가 성공적으로 등록되면 자동으로 카카오톡 공유 다이얼로그가 표시됩니다:

**다이얼로그 내용:**
- 제목: "카카오톡으로 공유하기"
- 설명: "새로운 오더를 카카오톡 단체방에 공유하시겠어요?"
- 미리보기: 오더 제목, 지역, 카테고리
- 버튼: "나중에" / "공유하기"

### 3. 공유 메시지 내용
카카오톡으로 공유되는 메시지에는 다음 정보가 포함됩니다:

```
🔨 새 오더: [오더 제목]

📍 지역: [지역명]
🏷️ 카테고리: [카테고리]
💰 예산: [예산 금액]원 (있는 경우)

📝 [설명 내용] (있는 경우, 최대 100자)

올수리에서 확인하세요!
```

**이미지:**
- 오더 생성 시 업로드한 첫 번째 사진
- 사진이 없는 경우: 올수리 기본 로고

**버튼:**
1. "오더 자세히 보기" - 앱 또는 웹에서 오더 상세 페이지로 이동
2. "오픈채팅방 참여" - 올수리 오픈채팅방 링크

## 🔧 기술 구현

### 파일 구조
```
lib/
├── services/
│   └── kakao_share_service.dart  # 카카오톡 공유 서비스
└── screens/
    └── business/
        └── create_job_screen.dart  # 공사 생성 화면
```

### 주요 메서드

#### 1. KakaoShareService.shareOrder()
```dart
Future<bool> shareOrder({
  required String orderId,
  required String title,
  required String region,
  required String category,
  double? budgetAmount,
  String? imageUrl,
  String? description,
})
```

**파라미터:**
- `orderId`: 오더 ID (marketplace_listings 테이블의 ID)
- `title`: 오더 제목
- `region`: 지역
- `category`: 카테고리
- `budgetAmount`: 예산 금액 (선택)
- `imageUrl`: 대표 이미지 URL (선택)
- `description`: 오더 설명 (선택)

**반환값:**
- `true`: 공유 성공
- `false`: 공유 실패

#### 2. _showKakaoShareDialog()
공유 다이얼로그를 표시하는 메서드 (CreateJobScreen 내부)

## 📱 사용자 경험

### 성공 시나리오
1. 사업자가 공사 정보 입력 및 사진 업로드
2. "공사 등록" 버튼 클릭
3. "오더로 올리기" 선택
4. 카카오톡 공유 다이얼로그 자동 표시
5. "공유하기" 버튼 클릭
6. 카카오톡 앱이 열리며 공유 대상 선택 화면 표시
7. 단체방 선택 후 전송
8. 오더 마켓플레이스 화면으로 이동

### 선택 옵션
- **"나중에"**: 공유를 건너뛰고 바로 오더 마켓플레이스로 이동
- **"공유하기"**: 카카오톡 공유 프로세스 시작

### 카카오톡 미설치 시
- 웹 브라우저로 카카오톡 공유 페이지가 열립니다
- PC 카카오톡이나 모바일 웹에서 공유 가능

## 🎨 UI/UX 특징

### 다이얼로그 디자인
- **카카오톡 브랜드 컬러**: 노란색 (#FAE100) 배경의 아이콘
- **미리보기**: 공유될 내용을 사전에 확인 가능
- **명확한 안내**: "단체방 선택 화면이 열립니다" 안내 문구

### 피드백
- 공유 성공 시: 녹색 스낵바 "✅ 카카오톡 공유가 시작되었습니다"
- 공유 실패 시: 빨간색 스낵바 "❌ 카카오톡 공유에 실패했습니다"

## 🔐 보안 및 제한사항

### 카카오 API 제한
- **자동 전송 불가**: 보안상 특정 채팅방에 자동으로 메시지를 보낼 수 없음
- **사용자 선택 필수**: 사용자가 직접 공유 대상(단체방)을 선택해야 함
- **스팸 방지**: 카카오톡의 스팸 방지 정책 준수

### 권한
- 카카오톡 공유는 별도의 사용자 권한이 필요하지 않음
- 카카오톡 앱 설치 여부만 확인

## 📊 데이터 흐름

```
1. 사업자가 공사 생성
   ↓
2. jobs 테이블에 저장
   ↓
3. "오더로 올리기" 선택
   ↓
4. marketplace_listings 테이블에 저장 (오더 생성)
   ↓
5. 다른 사업자들에게 푸시 알림 전송
   ↓
6. 카카오톡 공유 다이얼로그 표시 ← 새로운 기능
   ↓
7. 사용자가 "공유하기" 선택 시
   ↓
8. KakaoShareService.shareOrder() 호출
   ↓
9. 카카오톡 앱 열림 (공유 대상 선택)
   ↓
10. 오더 마켓플레이스로 이동
```

## 🧪 테스트 체크리스트

### 기본 기능
- [ ] 오더 생성 후 공유 다이얼로그가 자동으로 표시되는가?
- [ ] "나중에" 버튼 클릭 시 다이얼로그가 닫히고 오더 마켓으로 이동하는가?
- [ ] "공유하기" 버튼 클릭 시 카카오톡 앱이 열리는가?

### 데이터 표시
- [ ] 오더 제목이 올바르게 표시되는가?
- [ ] 지역 정보가 올바르게 표시되는가?
- [ ] 카테고리가 올바르게 표시되는가?
- [ ] 예산 금액이 천 단위 구분자와 함께 표시되는가?
- [ ] 업로드한 사진이 공유 메시지에 포함되는가?

### 예외 처리
- [ ] 카카오톡 미설치 시 웹 브라우저로 대체되는가?
- [ ] 사진이 없는 경우 기본 로고가 표시되는가?
- [ ] 예산이 없는 경우 예산 정보가 생략되는가?
- [ ] 설명이 100자 이상일 때 잘려서 표시되는가?

### 사용자 피드백
- [ ] 공유 성공 시 스낵바가 표시되는가?
- [ ] 공유 실패 시 에러 스낵바가 표시되는가?

## 🚀 향후 개선 사항

### 가능한 개선
1. **공유 통계**: 어떤 오더가 몇 번 공유되었는지 추적
2. **즐겨찾기 단체방**: 자주 사용하는 단체방을 앱 내에서 저장
3. **공유 템플릿 커스터마이징**: 사업자가 공유 메시지 내용을 일부 수정 가능
4. **공유 히스토리**: 어떤 오더를 언제 공유했는지 기록

### 제한사항
- ❌ 특정 단체방에 자동 전송: 카카오 API 정책상 불가능
- ❌ 여러 단체방에 동시 전송: 사용자가 매번 선택해야 함

## 📞 문의 및 지원

기능 관련 문의나 버그 리포트는 개발팀에 문의해주세요.

---

**마지막 업데이트**: 2025-01-06
**버전**: 1.0.0

